<div header >
	<nav id=header__ID class="navbar navbar-default navbar-fixed-top">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
		  <div class='hidden-xs hidden-sm'>
	      	<a class="navbar-brand" onclick="vm_nav_click_process('home');" style='cursor:pointer'><img src="images/astn_logo.gif" style="height:60px"></a>
		  </div>
		  <div class='hidden-md hidden-lg'>
	      	<a class="navbar-brand" onclick="vm_nav_click_process('home');"  style='cursor:pointer'><img src="images/astn_logo.gif"  style="height:30px"></a>
		  </div>
	    </div>
	    <div class="collapse navbar-collapse" id="myNavbar" style='padding-right:50px'>
	      <ul class="nav navbar-nav navbar-right">
	        <li><a onclick="vm_nav_click_process('home');" style='cursor:pointer'><i class="fa fa-home"></i>HOME</a></li>
				<li><a onclick="vm_nav_click_process('lift-osa');" style='cursor:pointer'><i class="fa fa-th"></i>Lift-OSA Export</a></li>
			<li><a onclick="vm_nav_click_process('aused');" style='cursor:pointer'><i class="fa fa-th"></i> AUSED Drving Simulator</a></li>
			<li><a onclick="vm_nav_click_process('astn');" style='cursor:pointer'><i class="fa fa-th"></i> ASTN Sleep Health Questionnaire</a></li>
			<li><a name=signinout onclick="vm_nav_click_process('signinout')" style='cursor:pointer'></a></li>
	      </ul>
	    </div>
	  </div>
	</nav>
	<script navigation-processing>
		//-----------------------------------------
		var vm_nav_click_process=function(name){
			if( $(window).width()<786) $('.navbar-toggle').click();
			switch(name){
				case 'signinout':
					if($vm.user=='guest'){
						window.open($VmAPI.api_base+"signin.html?url="+window.location.href,"Sign In","width=600, height=600");
					}
					else{
						$VmAPI.clear_token();
						$VmAPI.request({data:{cmd:'signout'},callback:function(c){
							$vm.user="guest";
							$vm.user_id="";
							location.reload(true);
						}});
					}
					break;
				default:
					if(name=='dev'){
						$vm.alert('Under development');
					}
					else load_module(name);
					break;
			}
		}
		//-----------------------------------------
		var check_trust=function(url){
			var trust=0;
			if(url.indexOf('http://127.0.0.1')!=-1 || url.indexOf('http://localhost')!=-1){
				trust=1;
			}
			else{
				for(var i=0;i<$vm.trust_path.length;i++){
					var len=$vm.trust_path[i].length;
					if(url.indexOf($vm.trust_path[i])!==-1 && url.substring(0,len)==$vm.trust_path[i]){
						trust=1;
					}
				}
			}
			if(trust==0){
				alert("The url ("+url+") is not trusted.")
			}
			return trust;
		}
		//-----------------------------------------
		var load_module=function(name){
			if($vm.app_config.modules[name]!=undefined && $vm.app_config.modules[name].url!=undefined){
				if($vm.module_list[name]==undefined){
					$vm.module_list[name]=$vm.app_config.modules[name];
				}
			}
			var url=$vm.module_list[name].url;
			if(url.split('.').pop().split('?')[0]=='json'){
				load_panel(name)
				return;
			}
			if(url[0]=='/'){
				if($vm.hosting_path!=undefined) url=$vm.hosting_path+url;
			}
			var single_record=$vm.module_list[name].single_record;
			if(check_trust(url)==0) return;
			var op={
				//-----------------
				sys:{
					config:$vm.app_config,
					UID:name,
				},
				//-----------------
			}
			var slot=$vm.root_layout_content_slot;
			if(single_record=='1') slot=undefined;
			$vm.load_module_by_name(name,slot,op)
		};
		//---------------------------------------------
		var load_panel=function(name){
			var url=$vm.module_list[name].url;
			if(url[0]=='/'){
				if($vm.hosting_path!=undefined) url=$vm.hosting_path+url;
			}
			if(check_trust(url)==0) return;
			console.log('loading '+url);
			$.get(url,function(text){
				var text=$('<div/>').html(text).text();
				//---------------------------
				var config;
				try{ config=JSON.parse(text); }
				catch (e){ alert("Error in config file\n"+e); return; }
				//-----------------------------------------------
				var module=name+"_panel";
				if($vm.module_list[module]==undefined){
					$vm.module_list[module]={
						url:config.url,
						var:{},
					}
				}
				$vm.load_module_by_name(module,$vm.root_layout_content_slot,{
					sys:{
						config:config,
						UID:name,
					}
				})
				//-----------------------------------------------
			},'text').fail(function() {
				alert( "The file '"+url+"' doesn't exist!" );
			});
		}
		//---------------------------------------------
		var show_sign=function(){
			if($vm.user=='guest'){
				$('a[name=signinout]').html('<i class="fa fa-user"></i> SIGN IN')
				$('#username__ID').text('');
			}
			else{
				$('a[name=signinout]').html('<i class="fa fa-user"></i> SIGN OUT')
				$('#username__ID').text('Signed in as '+ $vm.user);
			}
		}
		show_sign();
		//-----------------------------------------
	</script>
	<style>
		#myNavbar{
			padding-top:30px;
		}
		@media screen and (max-width:768px){
			#myNavbar{
				padding-top:0px;
			}
		}
		.navbar {
	        font-family: Montserrat, sans-serif;
	        margin-bottom: 0;
	        background-color: #FFF;
	        border: 0;
	        font-size: 11px !important;
	        letter-spacing: 4px;
	        opacity: 0.9;
	    }
	    .navbar li a, .navbar .navbar-brand {
	        color: #000 !important;
	    }
	    .navbar-nav li a:hover {
	        color: #009A54 !important;
	    }
	    .navbar-nav li.active a {
	        color: #009A54 !important;
	        background-color: #29292c !important;
	    }
	    .navbar-default .navbar-toggle {
	        border-color: transparent;
	    }
	    .open .dropdown-toggle {
	        color: #fff;
	        background-color: #555 !important;
	    }
	    .dropdown-menu li a {
	        color: #000 !important;
	    }
	    .dropdown-menu li a:hover {
	        background-color: red !important;
	    }
	</style>
</div>
